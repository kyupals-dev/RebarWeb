<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rebar Vista - Camera</title>
  
  <!-- CSS Files -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/mainpage.css') }}">
</head>

<body>
  <!-- Header Navigation (consistent with welcome page) -->
  <header class="header">
    <div class="nav-container">
      <div class="logo-section">
        <img src="{{ url_for('static', filename='logo/logo_no_bg.png') }}" alt="Rebar Vista Logo" class="nav-logo">
        <div class="brand-name">
          <div class="brand-name-top">Rebar</div>
          <div class="brand-name-bottom">Vista</div>
        </div>
      </div>
      
      <div class="header-title">
        <h1>AI Camera Analysis</h1>
      </div>
    </div>
  </header>

  <!-- Camera Interface -->
  <main class="camera-interface">
    <div class="camera-container" id="camera-container">
      <!-- Camera Feeds -->
      <img id="server-feed" alt="A4Tech Camera Feed">
      <video id="camera-feed" autoplay playsinline muted style="display: none;"></video>
      <img id="captured-preview" alt="Captured Image">
      
      <!-- Camera Status -->
      <div class="camera-status" id="camera-status">Starting A4Tech Camera...</div>
      
      <!-- Loading Overlay -->
      <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Analyzing rebar structure...</div>
      </div>
      
      <!-- Camera Controls Overlay -->
      <div class="camera-controls">
        <!-- Tutorial Button -->
        <button class="tutorial-btn" id="tutorial-btn" title="How to use">❓</button>
        
        <!-- Close Preview Button -->
        <button class="close-preview-btn" id="close-preview-btn" title="Back to live feed">✕</button>
        
        <!-- Bottom Controls -->
        <div class="bottom-controls">
          <!-- Gallery Button -->
          <button class="gallery-btn" id="gallery-btn" title="View Gallery">📁</button>
          
          <!-- Capture Button (Live Mode) -->
          <button class="capture-btn" id="capture-btn" title="Capture Image">📷</button>
          
          <!-- Preview Mode Controls -->
          <div class="preview-controls" id="preview-controls">
            <button class="analyze-btn" id="analyze-btn" title="Analyze Rebar">🔍</button>
            <button class="delete-btn" id="delete-btn" title="Delete Image">🗑️</button>
          </div>
          
          <!-- Fullscreen Button -->
          <button class="fullscreen-btn" id="fullscreen-btn" title="Fullscreen">⛶</button>
        </div>
      </div>
    </div>
  </main>

  <!-- Tutorial Modal -->
  <div class="modal-overlay tutorial-modal" id="tutorial-modal">
    <div class="modal-content">
      <h2>How to Use Rebar Vista</h2>
      
      <div class="tutorial-step">
        <div class="tutorial-step-number">1</div>
        <div>
          <strong>Position the camera</strong><br>
          Point the camera at the rebar column structure with good lighting
        </div>
      </div>
      
      <div class="tutorial-step">
        <div class="tutorial-step-number">2</div>
        <div>
          <strong>Capture the image</strong><br>
          Press the camera button (📷) in the center to take a photo
        </div>
      </div>
      
      <div class="tutorial-step">
        <div class="tutorial-step-number">3</div>
        <div>
          <strong>Review the capture</strong><br>
          The live feed will be replaced with your captured image
        </div>
      </div>
      
      <div class="tutorial-step">
        <div class="tutorial-step-number">4</div>
        <div>
          <strong>Analyze or Delete</strong><br>
          Press Analyze (🔍) to process the image, or Delete (🗑️) to discard it
        </div>
      </div>
      
      <div class="tutorial-step">
        <div class="tutorial-step-number">5</div>
        <div>
          <strong>View results</strong><br>
          Analysis results will show rebar dimensions and cement mixture ratios
        </div>
      </div>
      
      <div class="modal-buttons">
        <button class="modal-btn primary" onclick="closeTutorialModal()">Got it!</button>
      </div>
    </div>
  </div>

  <!-- Results Modal -->
  <div class="modal-overlay results-modal" id="results-modal">
    <div class="modal-content">
      <div class="results-header">
        <h2>Rebar Analysis Results</h2>
      </div>
      <div class="results-body">
        <img id="results-image" src="" alt="Analysis Result" class="results-image">
        <div class="results-data">
          <div class="result-card">
            <h3>Rebar Dimensions</h3>
            <div class="result-value" id="dimensions-result">25.4cm × 25.4cm × 200cm</div>
          </div>
          <div class="result-card">
            <h3>Cement Mixture Ratio</h3>
            <div class="result-value" id="mixture-result">1 Cement : 2 Sand : 3 Aggregate</div>
          </div>
        </div>
        <div class="modal-buttons">
          <button class="modal-btn secondary" onclick="closeResultsModal()">Close</button>
          <button class="modal-btn primary" onclick="saveResults()">Save to Gallery</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Modal -->
  <div class="modal-overlay error-modal" id="error-modal">
    <div class="modal-content">
      <div class="error-icon">⚠️</div>
      <h2>No Rebar Detected</h2>
      <p>The AI could not detect any rebar structures in the captured image. Please ensure the rebar is clearly visible and try again.</p>
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeErrorModal()">Try Again</button>
      </div>
    </div>
  </div>

  <!-- JavaScript Files -->
  <script src="{{ url_for('static', filename='javascript/camera.js') }}"></script>
</body>
</html>
